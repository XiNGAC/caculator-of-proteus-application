C51 COMPILER V9.56.0.0   CODE                                                              10/15/2018 11:06:47 PAGE 1   


C51 COMPILER V9.56.0.0, COMPILATION OF MODULE CODE
OBJECT MODULE PLACED IN .\Objects\code.obj
COMPILER INVOKED BY: D:\keil_2738\C51\BIN\C51.EXE ..\code.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings
                    -\code.lst) TABS(2) OBJECT(.\Objects\code.obj)

line level    source

   1          #include <reg51.h>
   2          #define uint  unsigned int
   3          #define uchar unsigned char
   4          
   5          sbit  lcden = P2 ^ 2;       /* å¯ç”¨ ä¸‹é™æ²¿ */
   6          sbit  rs  = P2 ^ 0;       /* é«˜ç”µå¹³è¾“å…¥æ•°æ®ï¼Œä½Žç”µå¹³è¾“å…¥å‘½ä»¤ */
   7          sbit  rw  = P2 ^ 1;       /* é«˜ç”µå¹³è¯»ï¼Œä½Žç”µå¹³å†™ */
   8          sbit  busy  = P0 ^ 7;
   9          
  10          char  i, j, temp, num, num_1;
  11          int a, b, c, result;
  12          int clear;
  13          int mod;
  14          /* aä¸ºè¾“å…¥çš„ç¬¬ä¸€ä¸ªæ•°ï¼Œbä¸ºè¾“å…¥çš„ç¬¬äºŒä¸ªæ•°ï¼Œcä¸ºå¾—æ•° */
  15          /* clearè¡¨ç¤ºæ˜¯å¦è¿›è¡Œæ¸…é›¶æ“ä½œï¼Œå¦‚æžœæ²¡æœ‰åšæ¸…é›¶æ“ä½œï¼Œåˆ™è®¡ç®—ä¹‹åŽå†ç›´æŽ¥è¾“å…¥ç¬¦å
             -·çš„è¯ï¼Œè‡ªåŠ¨æŠŠå½“å‰è®¡ç®—ç»“æžœè®¾ä¸ºç¬¬ä¸€è®¡ç®—æ•° */
  16          uchar flag, fuhao;
  17          /*
  18           * flag=1è¡¨ç¤ºè¿ç®—ç¬¦é”®æŒ‰ä¸‹ï¼Œflag=0è¡¨ç¤ºè¿ç®—ç¬¦é”®æ²¡æœ‰æŒ‰ä¸‹ï¼›
  19           * fuhao=1ä¸ºåŠ æ³•ï¼Œfuhao=2ä¸ºå‡æ³•ï¼Œfuhao=3ä¸ºä¹˜æ³•ï¼Œfuhao=4ä¸ºé™¤æ³•ã€‚
  20           */
  21          
  22          uchar code  table[] = {                             /* è¿ç®—æ•°å­—è¾“å…¥æ•°ç»„ */
  23            7, 8, 9, 0,
  24            4, 5, 6, 0,
  25            1, 2, 3, 0,
  26            0, 0, 0, 0
  27          };
  28          uchar code  table1[] = {                            /* ç»å¤„ç†åŽè¿›è¡Œé”®è¾“å…¥æ˜¾ç¤ºå‡†å¤‡çš„æ•°ç»„ */
  29            7,       8, 9,       0x2f - 0x30,       /* 7ï¼Œ8ï¼Œ9ï¼ŒÃ· */
  30            4,       5, 6,       0x2a - 0x30,       /* 4, 5, 6ï¼ŒÃ— */
  31            1,       2, 3,       0x2d - 0x30,       /* 1, 2, 3ï¼Œï¼ */
  32            0x01 - 0x30, 0, 0x3d - 0x30, 0x2b - 0x30        /* Cï¼Œ0ï¼Œ=ï¼Œï¼‹ */
  33          };
  34          
  35          void delay( uchar z )                                   /* å»¶è¿Ÿå‡½æ•° */
  36          {
  37   1        uchar y;
  38   1        for ( z; z > 0; z-- )
  39   1          for ( y = 0; y < 110; y++ )
  40   1            ;
  41   1      }
  42          
  43          
  44          void write_com( uchar com )                             /* å†™æŒ‡ä»¤å‡½æ•° */
  45          {
  46   1        rs      = 0;
  47   1        P0      = com;                  /* comæŒ‡ä»¤ä»˜ç»™P0å£ */
  48   1        delay( 5 ); lcden = 1; delay( 5 ); lcden = 0;
  49   1      }
  50          
  51          
  52          void write_date( uchar date )                           /* å†™æ•°æ®å‡½æ•° */
  53          {
C51 COMPILER V9.56.0.0   CODE                                                              10/15/2018 11:06:47 PAGE 2   

  54   1        rs  = 1; P0 = date; delay( 5 );
  55   1        lcden = 1; delay( 5 ); lcden = 0;
  56   1      }
  57          
  58          
  59          void init()                                             /* åˆå§‹åŒ– */
  60          {
  61   1        num = -1;
  62   1        lcden = 1;                                    /* ä½¿èƒ½ä¿¡å·ä¸ºé«˜ç”µå¹³ */
  63   1        rw  = 0;
  64   1        write_com( 0x38 );                              /* 8ä½ï¼Œ2è¡Œ */
  65   1        delay( 5 ); write_com( 0x38 );                  /* 8ä½ï¼Œ2è¡Œ */
  66   1        delay( 5 ); write_com( 0x0c );                  /* æ˜¾ç¤ºå¼€ï¼Œå…‰æ ‡å…³ï¼Œä¸é—ªçƒ* / */
  67   1        delay( 1 ); write_com( 0x06 );                  /* å¢žé‡æ–¹å¼ä¸ç§»ä½ æ˜¾ç«Ÿç—æšŒè´« æŸš? */
  68   1        delay( 1 ); write_com( 0x80 );                  /* æ£€æµ‹å¿™ä¿¡å· */
  69   1        delay( 1 ); write_com( 0x01 );                  /* æ˜¾ç¤ºå¼€ï¼Œå…‰æ ‡å…³ï¼Œä¸é—ªçƒ */
  70   1        num_1 = 0;
  71   1        i = 0; j = 0;
  72   1        a = 0;                                    /* ç¬¬ä¸€ä¸ªå‚ä¸Žè¿ç®—çš„æ•° */
  73   1        b = 0;                                    /* ç¬¬äºŒä¸ªå‚ä¸Žè¿ç®—çš„æ•° */
  74   1        c = 0;
  75   1        flag  = 0;                                    /* flagè¡¨ç¤ºæ˜¯å¦æœ‰ç¬¦å·é”®æŒ‰ä¸‹ï¼Œ */
  76   1        fuhao = 0;                                    /* fuhaoè¡¨å¾æŒ‰ä¸‹çš„æ˜¯å“ªä¸ªç¬¦å· */
  77   1      }
  78          
  79          
  80          /*
  81           * å¯¹äºŽ4Ã—4é”®ç›˜éœ€è¦8æ¡æ•°æ®çº¿ï¼Œ4æ ¹è¡Œçº¿ï¼Œ4æ ¹åˆ—çº¿ã€‚éƒ½æŽ¥åœ¨P3å£ä¸Šï¼Œä½Ž4ä½æŽ¥è¡Œ4æ ¹çº
             -¿ï¼Œé«˜4ä½æŽ¥åˆ—4æ ¹çº¿ã€‚å¦‚ä½•ç¡®å®š16ä¸ªé”®é‚£ä¸ªè¢«æŒ‰ä¸‹ï¼Œæ˜¯é€šè¿‡ç¨‹åºå¯¹é”®ç›˜æ‰«æï¼Œè¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼Œå
             -…ˆè®©ç¬¬ä¸€è¡Œçº¿ä¸ºä½Žç”µå¹³ä»£ç ä¸º11111110è½¬æ¢æˆåå…­è¿›åˆ¶ä¸º0xfeï¼Œç´§æŽ¥ç€ä¸‹æ¡è¯­å¥æ˜¯è¯»å–P3å£å€¼å¹¶äº
             -Ž0xfeæ¯”è¾ƒï¼Œå¦‚æžœç›¸ç­‰è¯´æ˜Žæ²¡æœ‰æŒ‰é”®è¢«å®‰ä¸‹ï¼Œå¦‚æžœä¸ç›¸ç­‰æœ‰æŒ‰é”®è¢«æŒ‰ä¸‹ï¼Œå‡å¦‚ç¬¬1è¡Œç¬¬1åˆ—æŒ‰é”®è¢
             -«æŒ‰ä¸‹è¿™æ—¶è¯»å–å€¼ä¸º11101110ï¼Œé«˜4ä½æ˜¯è¡¨ç¤ºåˆ—æ•°ï¼Œé«˜4ä½1110è¡¨ç¤ºç¬¬ä¸€åˆ—ä¸Šçš„æŒ‰é”®æœ‰è¢«æŒ‰ä¸‹çš„ï¼Œå†
             -é€šè¿‡ä½Ž4ä½å€¼1110å¯åˆ¤å®šç¬¬ä¸€è¡Œç¬¬ä¸€åˆ—çš„æŒ‰é”®è¢«æŒ‰ã€‚
  82           * è¿™æ ·å®Œæˆç¬¬ä¸€è¡Œçš„æ‰«æï¼Œç´§ç€è¦è¿›è¡Œç¬¬äºŒè¡Œçš„æ‰«æï¼Œä½¿P3ç­‰äºŽ11111101åå…­è¿›åˆ¶ä¸º
             -0xfdã€‚å†å®Œæˆä¸Šè¿°è¿‡ç¨‹ã€‚å†å¾€ä¸‹æ˜¯ç¬¬ä¸‰ï¼Œç¬¬å››è¡Œã€‚ä»¥ä¸Šè¿‡ç¨‹ä¸åœçš„å¾ªçŽ¯ã€‚
  83           */
  84          
  85          void keyscan()                                          /* é”®ç›˜æ‰«æç¨‹åº */
  86          {
  87   1        P3 = 0xfe;                                      /* è®©ç¬¬ä¸€è¡Œçº¿æ˜¯ä½Žç”µå¹³ */
  88   1        if ( P3 != 0xfe )
  89   1        {
  90   2          delay( 20 );                            /* å»¶è¿Ÿ20ms */
  91   2          if ( P3 != 0xfe )
  92   2          {
  93   3            temp = P3 & 0xf0;
  94   3            switch ( temp )
  95   3            {
  96   4            case 0xe0: num  = 0;   break;   /* 7 */
  97   4            case 0xd0: num  = 1;   break;   /* 8 */
  98   4            case 0xb0: num  = 2;   break;   /* 9 */
  99   4            case 0x70: num  = 3;   break;   /* Ã· */
 100   4            }
 101   3          }
 102   2          while ( P3 != 0xfe )
 103   2            ;
 104   2          if ( num == 0 || num == 1 || num == 2 ) /* å¦‚æžœæŒ‰ä¸‹çš„æ˜¯'7','8'æˆ–'9 */
 105   2          {
 106   3            if ( j != 0 )
 107   3            {
 108   4              write_com( 0x01 ); j = 0;
 109   4            }
C51 COMPILER V9.56.0.0   CODE                                                              10/15/2018 11:06:47 PAGE 3   

 110   3            if ( flag == 0 )                /* æ²¡æœ‰æŒ‰è¿‡è¿ç®—ç¬¦é”® */
 111   3            {
 112   4              a = a * 10 + table[num];
 113   4            }                               /*æŒ‰ä¸‹æ•°å­—å­˜å‚¨åˆ°a */
 114   3            else{ /* å¦‚æžœæŒ‰è¿‡è¿ç®—ç¬¦é”® */
 115   4              b = b * 10 + table[num];
 116   4            }                               /*æŒ‰ä¸‹æ•°å­—å­˜å‚¨åˆ°b */
 117   3          }else  { /* å¦‚æžœæŒ‰ä¸‹çš„æ˜¯'/'            é™¤æ³• */
 118   3            flag  = 1;                    /*æŒ‰ä¸‹è¿ç®—ç¬¦ */
 119   3            fuhao = 4;                    /* 4è¡¨ç¤ºé™¤å·å·²æŒ‰ */
 120   3          }
 121   2          i = table1[num];                        /* æ•°æ®æ˜¾ç¤ºåšå‡†å¤‡ */
 122   2          write_date( 0x30 + i );                 /* æ˜¾ç¤ºæ•°æ®æˆ–æ“ä½œç¬¦å· */
 123   2        }
 124   1      
 125   1        P3 = 0xfd;
 126   1        if ( P3 != 0xfd )
 127   1        {
 128   2          delay( 20 );
 129   2          if ( P3 != 0xfd )
 130   2          {
 131   3            temp = P3 & 0xf0;
 132   3            switch ( temp )
 133   3            {
 134   4            case 0xe0: num  = 4; break;                     /* 4 */
 135   4            case 0xd0: num  = 5; break;                     /* 5 */
 136   4            case 0xb0: num  = 6; break;                     /* 6 */
 137   4            case 0x70: num  = 7; break;                     /* Ã— */
 138   4            }
 139   3          }
 140   2          while ( P3 != 0xfd )
 141   2            ;                                               /* ç­‰å¾…æŒ‰é”®é‡Šæ”¾ */
 142   2          if ( num == 4 || num == 5 || num == 6 && num != 7 )     /* å¦‚æžœæŒ‰ä¸‹çš„æ˜¯'4','5'æˆ–'6' */
 143   2          {
 144   3            if ( j != 0 )
 145   3            {
 146   4              write_com( 0x01 );  j = 0;
 147   4            }
 148   3            if ( flag == 0 )                                /* æ²¡æœ‰æŒ‰è¿‡è¿ç®—ç¬¦é”® */
 149   3            {
 150   4              a = a * 10 + table[num];
 151   4            }else                           { /* å¦‚æžœæŒ‰è¿‡è¿ç®—ç¬¦é”® */
 152   4              b = b * 10 + table[num];
 153   4            }
 154   3          }else  { /* å¦‚æžœæŒ‰ä¸‹çš„æ˜¯'Ã—' */
 155   3            flag  = 1;
 156   3            fuhao = 3;    /* 3è¡¨ç¤ºä¹˜å·å·²æŒ‰ */
 157   3          }
 158   2          i = table1[num];        /* æ•°æ®æ˜¾ç¤ºåšå‡†å¤‡ */
 159   2          write_date( 0x30 + i ); /* æ˜¾ç¤ºæ•°æ®æˆ–æ“ä½œç¬¦å· */
 160   2        }
 161   1      
 162   1        P3 = 0xfb;
 163   1        if ( P3 != 0xfb )
 164   1        {
 165   2          delay( 20 );
 166   2          if ( P3 != 0xfb )
 167   2          {
 168   3            temp = P3 & 0xf0;
 169   3            switch ( temp )
 170   3            {
 171   4            case 0xe0: num  = 8;    break;          /* 1 */
C51 COMPILER V9.56.0.0   CODE                                                              10/15/2018 11:06:47 PAGE 4   

 172   4            case 0xd0: num  = 9;    break;          /* 2 */
 173   4            case 0xb0: num  = 10;   break;          /* 3 */
 174   4            case 0x70: num  = 11;   break;          /* - */
 175   4            }
 176   3          }
 177   2          while ( P3 != 0xfb )
 178   2            ;
 179   2          if ( num == 8 || num == 9 || num == 10 )        /* å¦‚æžœæŒ‰ä¸‹çš„æ˜¯'1','2'æˆ–'3' */
 180   2          {
 181   3            if ( j != 0 )
 182   3            {
 183   4              write_com( 0x01 );  j = 0;
 184   4            }
 185   3            if ( flag == 0 )                        /* æ²¡æœ‰æŒ‰è¿‡è¿ç®—ç¬¦é”® */
 186   3            {
 187   4              a = a * 10 + table[num];
 188   4            }else                         { /* å¦‚æžœæŒ‰è¿‡è¿ç®—ç¬¦é”® */
 189   4              b = b * 10 + table[num];
 190   4            }
 191   3          }else if ( num == 11 )                          /* å¦‚æžœæŒ‰ä¸‹çš„æ˜¯'-' */
 192   2          {
 193   3            flag  = 1;
 194   3            fuhao = 2;                            /* 2è¡¨ç¤ºå‡å·å·²æŒ‰ */
 195   3          }
 196   2          i = table1[num];                                /* æ•°æ®æ˜¾ç¤ºåšå‡†å¤‡ */
 197   2          write_date( 0x30 + i );                         /* æ˜¾ç¤ºæ•°æ®æˆ–æ“ä½œç¬¦å· */
 198   2        }
 199   1      
 200   1        P3 = 0xf7;
 201   1        if ( P3 != 0xf7 )
 202   1        {
 203   2          delay( 20 );
 204   2          if ( P3 != 0xf7 )
 205   2          {
 206   3            temp = P3 & 0xf0;
 207   3            switch ( temp )
 208   3            {
 209   4            case 0xe0: num  = 12; break;    /* æ¸…0é”® */
 210   4            case 0xd0: num  = 13; break;    /* æ•°å­—0 */
 211   4            case 0xb0: num  = 14; break;    /* ç­‰äºŽé”® */
 212   4            case 0x70: num  = 15; break;    /* åŠ  */
 213   4            }
 214   3          }
 215   2          while ( P3 != 0xf7 )
 216   2            ;
 217   2      
 218   2          switch ( num )
 219   2          {
 220   3          case 12: { write_com( 0x01 ); a = 0; b = 0; flag = 0; fuhao = 0; } /*æŒ‰ä¸‹çš„æ˜¯"æ¸…é›¶" */
 221   3                           break;
 222   3          case 13: {           /*æŒ‰ä¸‹çš„æ˜¯"0" */
 223   4            if ( flag == 0 ) /* æ²¡æœ‰æŒ‰è¿‡è¿ç®—ç¬¦é”® */
 224   4            {
 225   5              a = a * 10;  write_date( 0x30 );     P3 = 0;
 226   5            }else if ( flag >= 1 ) /* å¦‚æžœæŒ‰è¿‡è¿ç®—ç¬¦é”® */
 227   4            {
 228   5              b = b * 10;   write_date( 0x30 );
 229   5            }
 230   4          }     break;
 231   3          case 14: { j = 1;                               /*æŒ‰ä¸‹ç­‰äºŽé”®ï¼Œæ ¹æ®è¿ç®—ç¬¦å·è¿›è¡Œä¸åŒçš„ç®—
             -æœ¯å¤„ç† */
 232   4               if ( fuhao == 1 )                    /* åŠ æ³•è¿ç®— */
C51 COMPILER V9.56.0.0   CODE                                                              10/15/2018 11:06:47 PAGE 5   

 233   4               {
 234   5                 write_com( 0x80 + 0x4f );    /*æŒ‰ä¸‹ç­‰äºŽé”®ï¼Œå…‰æ ‡å‰è¿›è‡³ç¬¬äºŒè¡Œæœ€åŽä¸€ä¸ªæ˜¾ç¤ºå¤„ */
 235   5                 write_com( 0x04 );           /* è®¾ç½®ä»ŽåŽä½å‰å†™æ•°æ®ï¼Œæ¯å†™å®Œä¸€ä¸ªæ•°æ®ï¼Œå…‰æ ‡åŽé€€ä
             -¸€æ ¼ */
 236   5                 c = a + b;
 237   5                 result = c;
 238   5                 while ( c != 0 )
 239   5                 {
 240   6                   write_date( 0x30 + c % 10 );        c = c / 10;
 241   6                 }
 242   5                 write_date( 0x3d );          /* å†å†™"=" */
 243   5                 a = 0; b = 0; flag = 0; fuhao = 0;
 244   5               }  else if ( fuhao == 2 )            /* å‡æ³•è¿ç®— */
 245   4               {
 246   5                 write_com( 0x80 + 0x4f );    /* å…‰æ ‡å‰è¿›è‡³ç¬¬äºŒè¡Œæœ€åŽä¸€ä¸ªæ˜¾ç¤ºå¤„ */
 247   5                 write_com( 0x04 );           /* è®¾ç½®ä»ŽåŽä½å‰å†™æ•°æ®ï¼Œæ¯å†™å®Œä¸€ä¸ªæ•°æ®ï¼Œå…‰æ ‡åŽé€€ä
             -¸€æ ¼(è¿™ä¸ªç…§ç†è¯´é¡ºåºä¸å¯¹ï¼Œå¯æ˜¾ç¤ºå’Œä¸Šæ®µä¸€æ ·) */
 248   5                 if ( a - b > 0 )
 249   5                   c = a - b;
 250   5                 else c = b - a;
 251   5                 result = c;
 252   5                 while ( c != 0 )
 253   5                 {
 254   6                   write_date( 0x30 + c % 10 ); c = c / 10;
 255   6                 }
 256   5                 if ( a - b < 0 )
 257   5                   write_date( 0x2d );
 258   5                 write_date( 0x3d );  /* å†å†™"=" */
 259   5                 a = 0; b = 0; flag = 0; fuhao = 0;
 260   5               }   else if ( fuhao == 3 )   /* ä¹˜æ³•è¿ç®— */
 261   4               {
 262   5                 write_com( 0x80 + 0x4f );            write_com( 0x04 );
 263   5                 c    = a * b;
 264   5                 result = c;
 265   5                 while ( c != 0 )
 266   5                 {
 267   6                   write_date( 0x30 + c % 10 );        c = c / 10;
 268   6                 }
 269   5                 write_date( 0x3d );           a = 0; b = 0; flag = 0; fuhao = 0;
 270   5               }  else if ( fuhao == 4 ) /* é™¤æ³•è¿ç®— */
 271   4               {
 272   5                 write_com( 0x80 + 0x4f );
 273   5                 write_com( 0x04 );
 274   5                 i = 0;
 275   5                 if ( b != 0 )
 276   5                 {
 277   6                   c = a / b;
 278   6                   mod = a - (c * b);
 279   6                   while ( c != 0 )
 280   6                   {
 281   7                      write_date( 0x30 + c % 10 );        c = c / 10;             
 282   7                   }
 283   6                   write_date( 0x3d );
 284   6                    write_com( 0x80 + 0x23);
 285   6                    write_com( 0x04 );
 286   6                    while(mod != 0)
 287   6                    {
 288   7                      write_date( 0x30 + mod % 10 );
 289   7                      mod = mod / 10;
 290   7                    }
 291   6                    write_date(0x3d);
 292   6                    write_date(0x64);
C51 COMPILER V9.56.0.0   CODE                                                              10/15/2018 11:06:47 PAGE 6   

 293   6                    write_date(0x6f);
 294   6                    write_date(0x6d);
 295   6                   a = 0; b = 0; flag = 0; fuhao = 0;
 296   6                 }else  {
 297   6                   write_date( '!' ); write_date( 'R' ); write_date( 'O' );
 298   6                   write_date( 'R' ); write_date( 'R' ); write_date( 'E' );
 299   6                 }
 300   5               }
 301   4          }  break;
 302   3          case 15: { write_date( 0x30 + table1[num] ); flag = 1; fuhao = 1; }     break;
 303   3          }
 304   2        } /* P2!=0xf7 */
 305   1      }
 306          
 307          
 308          main()
 309          {
 310   1        init();
 311   1        while ( 1 )
 312   1        {
 313   2          keyscan();
 314   2        }
 315   1      }
 316          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1435    ----
   CONSTANT SIZE    =     32    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     19    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
